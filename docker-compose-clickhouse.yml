---
version: '3.7'

services:
  pmm-server-external-clickhouse:
    image: ${PMM_SERVER_IMAGE:-perconalab/pmm-server:dev-latest}
    container_name: pmm-server-clickhouse
    ports:
      - "8081:80"
      - "8443:443"
    environment:
      - PMM_DEBUG=1
      - PERCONA_TEST_SAAS_HOST=check-dev.percona.com:443
      - PERCONA_TEST_CHECKS_PUBLIC_KEY=RWTg+ZmCCjt7O8eWeAmTLAqW+1ozUbpRSKSwNTmO+exlS5KEIPYWuYdX
      - PERCONA_TEST_VERSION_SERVICE_URL=https://check-dev.percona.com/versions/v1
      - PERCONA_TEST_TELEMETRY_INTERVAL=10s
      - PERCONA_TEST_TELEMETRY_RETRY_BACKOFF=10s
      - PERCONA_TEST_PMM_CLICKHOUSE_ADDR=127.0.0.1:9009
      - PERCONA_TEST_PMM_CLICKHOUSE_DATABASE=pmm2
      - PERCONA_TEST_PMM_CLICKHOUSE_POOL_SIZE=1 
      - PERCONA_TEST_PMM_CLICKHOUSE_BLOCK_SIZE=65000

  external-clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: external-clickhouse
    ports:
      - "9009:9000"