---
version: '3.7'

networks:
  pmm-network:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.0.0/24
          gateway: 192.168.0.1

services:
  pmm-server:
    image: ${PMM_SERVER_IMAGE:-perconalab/pmm-server:dev-latest}
    container_name: pmm-server
    ports:
      - "8081:80"
      - "8443:443"
    environment:
      - PMM_DEBUG=1
      - PERCONA_TEST_SAAS_HOST=check-dev.percona.com:443
      - PERCONA_TEST_CHECKS_PUBLIC_KEY=RWTg+ZmCCjt7O8eWeAmTLAqW+1ozUbpRSKSwNTmO+exlS5KEIPYWuYdX
      - PERCONA_TEST_VERSION_SERVICE_URL=https://check-dev.percona.com/versions/v1
      - PERCONA_TEST_TELEMETRY_INTERVAL=10s
      - PERCONA_TEST_TELEMETRY_RETRY_BACKOFF=10s
    networks:
      - pmm-network

  external-clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: external-clickhouse